<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Trait Simulation - Ordinal Multinomial Power · TraitSimulation.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">TraitSimulation.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../testing_MendelIHT_glm/">Testing Methods</a></li><li><span class="tocitem">Real Data Examples</span><ul><li><a class="tocitem" href="../ukbiobank_vcm_power/">Trait Simulation - Variance Component Model Power (UKBiobank)</a></li><li class="is-active"><a class="tocitem" href>Trait Simulation - Ordinal Multinomial Power</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#Demonstration"><span>Demonstration</span></a></li><li class="toplevel"><a class="tocitem" href="#Reading-genotype-data-using-SnpArrays"><span>Reading genotype data using SnpArrays</span></a></li><li class="toplevel"><a class="tocitem" href="#Power-Calculation"><span>Power Calculation</span></a></li><li><a class="tocitem" href="#Citations:"><span>Citations:</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../GPU/">Exploring GPU Potential</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Real Data Examples</a></li><li class="is-active"><a href>Trait Simulation - Ordinal Multinomial Power</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Trait Simulation - Ordinal Multinomial Power</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/OpenMendel/TraitSimulation.jl/blob/master/docs/src/examples/ukbiobank_ordered_multinomial_power.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Trait-Simulation-Ordinal-Multinomial-Power"><a class="docs-heading-anchor" href="#Trait-Simulation-Ordinal-Multinomial-Power">Trait Simulation - Ordinal Multinomial Power</a><a id="Trait-Simulation-Ordinal-Multinomial-Power-1"></a><a class="docs-heading-anchor-permalink" href="#Trait-Simulation-Ordinal-Multinomial-Power" title="Permalink"></a></h1><p>Authors: Sarah Ji, Janet Sinsheimer, Kenneth Lange, Hua Zhou</p><p>In this notebook we show how to use the <code>TraitSimulation.jl</code> package we illustrate how TraitSimulation.jl can easily simulate traits from genotype data, all within the OpenMendel universe. Operating within this universe brings potential advantages over the available software(s) when needed for downstream analysis or study design. Using just a few calls on the command line to the appropriate packages within the OpenMendel, we demonstrate how to use the OpenMendel code pipeline to construct the genetic model, simulate the trait and find the power for the Ordinal Multinomial Trait.</p><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>The ordinal multinomial model is a powerful way to model stages of disease progression. For a disease like diabetes, the monitoring of the disease&#39;s progression may be improved based on several different biomarkers detected in the EHR data, such as diabetes diagnostic codes, diabetes medication, hyperglycemia in blood results defined by HbA1c and fasting glucose levels, and presence of diabetes process of care codes. Then these algorithm can better categorize individuals into disease progression categories that relate to how likely they are to have diabetes. This is motivated by the need for early diagnoses and effective intervention techniques. For a detailed review on the published ordinal model, we provide in the references our most recent published paper in Genetic Epidemiology, <a href="https://doi.org/10.1002/gepi.22276">Ordered multinomial regression for genetic association analysis of ordinal phenotypes at Biobank scale</a></p><p>This software package, TraitSimuliation.jl addresses the need for simulated trait data in genetic analyses.  This package generates data sets that will allow researchers to accurately check the validity of programs and to calculate power for their proposed studies. This package gives users the ability to easily simulate phenotypic traits under generalized linear models (GLMs) or variance component models (VCMs) conditional on PLINK formatted genotype data [3]. In addition, we demo customized simulation utilities that accompany specific genetic analysis options in Open-Mendel; for example, ordered, multinomial traits. We demonstrate these simulation utilities on the example dataset described below.</p><h2 id="Demonstration"><a class="docs-heading-anchor" href="#Demonstration">Demonstration</a><a id="Demonstration-1"></a><a class="docs-heading-anchor-permalink" href="#Demonstration" title="Permalink"></a></h2><h5 id="UK-Biobank-Example-Data"><a class="docs-heading-anchor" href="#UK-Biobank-Example-Data">UK Biobank Example Data</a><a id="UK-Biobank-Example-Data-1"></a><a class="docs-heading-anchor-permalink" href="#UK-Biobank-Example-Data" title="Permalink"></a></h5><p>The data in this demo is restricted to a subset of individuals of European ancestry excluding first- and second-degree relatives based off of kinship estimates. We filtered samples by 98% genotyping success rate on all chromosomes and SNPs by 99% genotyping success rate. These measures result in n = 185,565 individuals and 470,228 SNPs for analysis. A more detailed description of the data can be found in the references <a href="https://doi.org/10.1002/gepi.22276">3</a> The data from this notebook can be found in the UK Biobank repository under Project ID: 48152 and 15678 at <a href="https://www.ukbiobank.ac.uk">UK Biobank</a> with the permission of UK Biobank.</p><p>We will use the OpenMendel package <a href="https://openmendel.github.io/SnpArrays.jl/latest/">SnpArrays.jl</a> to read in the PLINK formatted data files.</p><h3 id="Double-check-that-you-are-using-Julia-version-1.0-or-higher-by-checking-the-machine-information"><a class="docs-heading-anchor" href="#Double-check-that-you-are-using-Julia-version-1.0-or-higher-by-checking-the-machine-information">Double check that you are using Julia version 1.0 or higher by checking the machine information</a><a id="Double-check-that-you-are-using-Julia-version-1.0-or-higher-by-checking-the-machine-information-1"></a><a class="docs-heading-anchor-permalink" href="#Double-check-that-you-are-using-Julia-version-1.0-or-higher-by-checking-the-machine-information" title="Permalink"></a></h3><pre><code class="language-julia">versioninfo()</code></pre><pre><code class="language-none">Julia Version 1.3.0
Commit 46ce4d7933 (2019-11-26 06:09 UTC)
Platform Info:
  OS: Linux (x86_64-pc-linux-gnu)
  CPU: Intel(R) Core(TM) i9-9920X CPU @ 3.50GHz
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-6.0.1 (ORCJIT, skylake)</code></pre><pre><code class="language-julia">using Plots, DataFrames, LinearAlgebra, StatsFuns, CSV
using SnpArrays, TraitSimulation, GLM, StatsBase, OrdinalMultinomialModels</code></pre><h1 id="Reading-genotype-data-using-SnpArrays"><a class="docs-heading-anchor" href="#Reading-genotype-data-using-SnpArrays">Reading genotype data using SnpArrays</a><a id="Reading-genotype-data-using-SnpArrays-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-genotype-data-using-SnpArrays" title="Permalink"></a></h1><p>First use <code>SnpArrays.jl</code> to read in the genotype data. We use PLINK formatted data with the same prefixes for the .bim, .fam, .bed files.</p><p>SnpArrays is a very useful utility and can do a lot more than just read in the data. More information about all the functionality of SnpArrays can be found at: https://openmendel.github.io/SnpArrays.jl/latest/</p><p>As missing genotypes are often due to problems making the calls, the called genotypes at a marker with too much missing genotypes are potentially unreliable. By default, SnpArrays filters to keep only the genotypes with success rates greater than 0.98 and the minimum minor allele frequency to be 0.01. If the user wishes to change the stringency, change the number given in filter according to <a href="https://openmendel.github.io/SnpArrays.jl/latest/#Fitering-1">SnpArrays</a>.</p><pre><code class="language-julia">filename = &quot;/mnt/UKBiobank/ukbdata/ordinalanalysis/ukb.plink.filtered&quot;
full_snps = SnpArray(filename * &quot;.bed&quot;);</code></pre><pre><code class="language-julia">full_snp_data = SnpData(filename)</code></pre><pre><code class="language-none">SnpData(people: 185565, snps: 470228,
snp_info:
│ Row │ chromosome │ snpid       │ genetic_distance │ position │ allele1      │ allele2      │
│     │ String     │ String      │ Float64          │ Int64    │ Categorical… │ Categorical… │
├─────┼────────────┼─────────────┼──────────────────┼──────────┼──────────────┼──────────────┤
│ 1   │ 1          │ rs3131972   │ 0.0              │ 752721   │ A            │ G            │
│ 2   │ 1          │ rs12184325  │ 0.0              │ 754105   │ T            │ C            │
│ 3   │ 1          │ rs3131962   │ 0.0              │ 756604   │ A            │ G            │
│ 4   │ 1          │ rs12562034  │ 0.0              │ 768448   │ A            │ G            │
│ 5   │ 1          │ rs116390263 │ 0.0              │ 772927   │ T            │ C            │
│ 6   │ 1          │ rs4040617   │ 0.0              │ 779322   │ G            │ A            │
…,
person_info:
│ Row │ fid       │ iid       │ father    │ mother    │ sex       │ phenotype │
│     │ Abstract… │ Abstract… │ Abstract… │ Abstract… │ Abstract… │ Abstract… │
├─────┼───────────┼───────────┼───────────┼───────────┼───────────┼───────────┤
│ 1   │ 1000019   │ 1000019   │ 0         │ 0         │ 1         │ -9        │
│ 2   │ 1000078   │ 1000078   │ 0         │ 0         │ 1         │ -9        │
│ 3   │ 1000081   │ 1000081   │ 0         │ 0         │ 1         │ -9        │
│ 4   │ 1000105   │ 1000105   │ 0         │ 0         │ 2         │ -9        │
│ 5   │ 1000112   │ 1000112   │ 0         │ 0         │ 1         │ -9        │
│ 6   │ 1000129   │ 1000129   │ 0         │ 0         │ 1         │ -9        │
…,
srcbed: /mnt/UKBiobank/ukbdata/ordinalanalysis/ukb.plink.filtered.bed
srcbim: /mnt/UKBiobank/ukbdata/ordinalanalysis/ukb.plink.filtered.bim
srcfam: /mnt/UKBiobank/ukbdata/ordinalanalysis/ukb.plink.filtered.fam
)</code></pre><pre><code class="language-julia">snpid = full_snp_data.snp_info[!, :snpid] # store the snp_info with the snp names
causal_snp_index = findall(x -&gt; x == &quot;rs6603811&quot;, snpid)[:] # find the index of the snp of interest by snpid</code></pre><pre><code class="language-none">1-element Array{Int64,1}:
 174</code></pre><p>The published hypertension GWAS analysis includes the following covariates: sex, center, age, age2, BMI, and the top ten principal components to adjust for ancestry/relatedness.</p><pre><code class="language-julia">causal_snp = @view full_snps[:, causal_snp_index]</code></pre><pre><code class="language-none">185565×1 view(::SnpArray, :, [174]) with eltype UInt8:
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
    ⋮
 0x03
 0x03
 0x03
 0x02
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03
 0x03</code></pre><pre><code class="language-julia">maf(causal_snp)</code></pre><pre><code class="language-none">1-element Array{Float64,1}:
 0.05023244010820205</code></pre><pre><code class="language-julia">locus = convert(Matrix{Float64}, causal_snp, impute = true)</code></pre><pre><code class="language-none">185565×1 Array{Float64,2}:
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 ⋮  
 2.0
 2.0
 2.0
 1.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0
 2.0</code></pre><h1 id="Power-Calculation"><a class="docs-heading-anchor" href="#Power-Calculation">Power Calculation</a><a id="Power-Calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Power-Calculation" title="Permalink"></a></h1><p>Now we show how to simulate from customized simulation models that accompany specific genetic analysis options in OpenMendel; for example, ordered, multinomial traits and Variance Component Models.</p><p>This example illustrates the use of the simulations to generates data sets allowing researchers to accurately check the validity of programs and to calculate power for their proposed studies.</p><p>We illustrate this example in three digestable steps:</p><ul><li>The first by simulating genotypes and covariate values representative for our study population.</li><li>Carry over the simulated design matrix from (1) to create the OrderedMultinomialTrait model object.</li><li>Simulate off the OrderedMultinomialTrait model object created in (2) and run the power analyses for the desired significance level.</li></ul><p>The published hypertension GWAS analysis includes the following covariates: sex, center, age, age2, BMI, and the top ten principal components to adjust for ancestry/relatedness.</p><pre><code class="language-julia">n = length(locus)
published_covariate_data = CSV.read(&quot;/mnt/UKBiobank/ukbdata/ordinalanalysis/Covariate_Final.csv&quot;)
covariates = published_covariate_data[:, :]
sex = Float64.(covariates[!, :sex])</code></pre><pre><code class="language-none">185565-element Array{Float64,1}:
 1.0
 1.0
 1.0
 0.0
 1.0
 1.0
 0.0
 0.0
 1.0
 1.0
 0.0
 0.0
 0.0
 ⋮  
 0.0
 1.0
 0.0
 0.0
 1.0
 1.0
 0.0
 0.0
 0.0
 0.0
 0.0
 1.0</code></pre><pre><code class="language-julia">β_full =
 [0.58
  0.022]</code></pre><pre><code class="language-none">3-element Array{Float64,1}:
 0.58
 0.022
 0.03</code></pre><pre><code class="language-julia">γs = collect(0.02:0.005:0.055)</code></pre><pre><code class="language-none">8-element Array{Float64,1}:
 0.02
 0.025
 0.03
 0.035
 0.04
 0.045
 0.05
 0.055</code></pre><pre><code class="language-julia">X_full = [sex locus]</code></pre><pre><code class="language-none">185565×3 Array{Float64,2}:
 1.0  1.0  2.0
 1.0  1.0  2.0
 1.0  1.0  2.0
 1.0  0.0  2.0
 1.0  1.0  2.0
 1.0  1.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 1.0  1.0  2.0
 1.0  1.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 ⋮            
 1.0  0.0  2.0
 1.0  1.0  2.0
 1.0  0.0  2.0
 1.0  0.0  1.0
 1.0  1.0  2.0
 1.0  1.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 1.0  0.0  2.0
 1.0  1.0  2.0</code></pre><pre><code class="language-julia">link = LogitLink()
θ = [1.0, 1.2, 1.4]

Ordinal_Model_Test = OrderedMultinomialTrait(X_full, β_full, θ, link)</code></pre><pre><code class="language-none">Ordinal Multinomial Model
  * number of fixed effects: 3
  * number of ordinal multinomial outcome categories: 4
  * link function: LogitLink
  * sample size: 185565</code></pre><p>Now, we can do the same procedure for three snps with different minor allele frequencies, and super impose the power plots to compare the trajectory.</p><pre><code class="language-julia">γs = collect(0.0:0.001:0.05)
plot(γs, m22_power, title = &quot;Ordered Multinomial Power&quot;, label = &quot;maf = 0.23&quot;, lw = 3 , legend = :left, legendfontsize= 9)  # plot power
plot!(γs, m109_power, label = &quot;SNP: rs76601697, maf = 0.11&quot;, lw = 3 )  # plot power
plot!(γs, m0_0502_power, label = &quot;maf = 0.05&quot;, lw = 3 )  # plot power
xlabel!(&quot;Odds Ratio for Associated SNP&quot;)
hline!([.8], label = &quot;power = 80%, n = 20,000, alpha = 5*10^-8&quot;, lw = 1)</code></pre><p><img src="../ordinalpower.png" alt="png"/></p><h2 id="Citations:"><a class="docs-heading-anchor" href="#Citations:">Citations:</a><a id="Citations:-1"></a><a class="docs-heading-anchor-permalink" href="#Citations:" title="Permalink"></a></h2><p>[1] Lange K, Papp JC, Sinsheimer JS, Sripracha R, Zhou H, Sobel EM (2013) Mendel: The Swiss army knife of genetic analysis programs. Bioinformatics 29:1568-1570.`</p><p>[2] OPENMENDEL: a cooperative programming project for statistical genetics. <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=OPENMENDEL">Hum Genet. 2019 Mar 26. doi: 10.1007/s00439-019-02001-z</a>.</p><p>[3] German, CA, Sinsheimer, JS, Klimentidis, YC, Zhou, H, Zhou, JJ. Ordered multinomial regression for genetic association analysis of ordinal phenotypes at Biobank scale. Genetic Epidemiology. 2019; 1– 13. https://doi.org/10.1002/gepi.22276</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ukbiobank_vcm_power/">« Trait Simulation - Variance Component Model Power (UKBiobank)</a><a class="docs-footer-nextpage" href="../GPU/">Exploring GPU Potential »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 31 March 2021 23:57">Wednesday 31 March 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
