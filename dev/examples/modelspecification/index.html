<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Alternative Model Specification · TraitSimulation.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">TraitSimulation.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../testing_MendelIHT_glm/">Testing Methods</a></li><li><span class="tocitem">Real Data Examples</span><ul><li><a class="tocitem" href="../ukbiobank_vcm_power/">Trait Simulation - Variance Component Model Power (UKBiobank)</a></li><li><a class="tocitem" href="../ukbiobank_ordered_multinomial_power/">Trait Simulation - Ordinal Multinomial Power</a></li></ul></li><li class="is-active"><a class="tocitem" href>Alternative Model Specification</a><ul class="internal"><li><a class="tocitem" href="#method-1:-VCMTrait(X,-B,-variance_formula)"><span>method 1: VCMTrait(X, B, variance_formula)</span></a></li><li><a class="tocitem" href="#method-2:-VCMTrait(mean_-formulas,-DataFrame,-variance_-formula)"><span>method 2: VCMTrait(mean_ formulas, DataFrame, variance_ formula)</span></a></li><li><a class="tocitem" href="#method-3:-VCMTrait(X,-B,-Σ,-V)"><span>method 3: VCMTrait(X, B, Σ, V)</span></a></li><li><a class="tocitem" href="#method-4:-VCMTrait(X,-B,-G,-γ,-variance_formula)"><span>method 4: VCMTrait(X, B, G, γ, variance_formula)</span></a></li><li><a class="tocitem" href="#method-5:-VCMTrait(X,-B,-G,-γ,-Σ,-V)"><span>method 5: VCMTrait(X, B, G, γ,  Σ, V)</span></a></li></ul></li><li><a class="tocitem" href="../simulate_testing_threads.jl/">Exploring Multithreading Potential</a></li><li><a class="tocitem" href="../GPU/">Exploring GPU Potential</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Alternative Model Specification</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Alternative Model Specification</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/OpenMendel/TraitSimulation.jl/blob/master/docs/src/examples/modelspecification.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Alternative-Model-Specification"><a class="docs-heading-anchor" href="#Alternative-Model-Specification">Alternative Model Specification</a><a id="Alternative-Model-Specification-1"></a><a class="docs-heading-anchor-permalink" href="#Alternative-Model-Specification" title="Permalink"></a></h1><p>TraitSimulation provides a variety of model specifications for a user-friendly interface convenient to the users problem setting.</p><p>In this notebook we demonstrate the different ways users can specify from a Variance Component Model. Note that the alternative model specification can be applied to the other simulation model in a similar fashion. </p><p>We encourage users to choose whichever specification method best suits their needs. </p><pre><code class="language-julia">using TraitSimulation, LinearAlgebra
using Random, DataFrames, Test, SnpArrays
Random.seed!(1234)

# First generate some demo-data

n = 10 # number of people
p = 2  # number of fixed effects
d = 2  # number of traits
m = 2  # number of variance components

function generateSPDmatrix(n)
    A = rand(n)
    m = 0.5 * (A * A&#39;)
    PDmat = m + (n * Diagonal(ones(n)))
end


function generateRandomVCM(n::Int64, p::Int64, d::Int64, m::Int64)
    # n-by-p design matrix
    X = randn(n, p)
    
    V = ntuple(x -&gt; zeros(n, n), m)
    for i = 1:m-1
      copy!(V[i], generateSPDmatrix(n))
    end
    copy!(V[end], Diagonal(ones(n))) # last covarianec matrix is identity

    # a tuple of m d-by-d variance component parameters
    Σ = ntuple(x -&gt; zeros(d, d), m)
    for i in 1:m
      copy!(Σ[i], generateSPDmatrix(d))
    end
    return(X, Σ, V)
end

X, Σ, V = generateRandomVCM(n, p, d, m) # generate random data, where variance components are Positive Semi-Definite
B = [[1.0;  0.950498]  [1.0;  0.96467]] # matrix of regression coefficients for non-genetic predictors 
maf = [0.2] # minor allele frequency of simulated SNP
G = snparray_simulation(maf, n) # simulate SnpArray (user can read in their own snps too)
locus = convert(Matrix{Float64}, G, model = ADDITIVE_MODEL, center=false, scale=false); # (convert the snp to Float64)
n_snps = length(maf) 
γ = [0.372575 0.150508]        # matrix of regression coefficients for genetic predictors
variance_formula = @vc Σ[1] ⊗ V[1] + Σ[2] ⊗ V[2] # variance components for model</code></pre><pre><code class="language-none">2-element Array{VarianceComponent,1}:
 Variance Component
  * number of traits: 2
  * sample size: 10
 Variance Component
  * number of traits: 2
  * sample size: 10</code></pre><h2 id="method-1:-VCMTrait(X,-B,-variance_formula)"><a class="docs-heading-anchor" href="#method-1:-VCMTrait(X,-B,-variance_formula)">method 1: VCMTrait(X, B, variance_formula)</a><a id="method-1:-VCMTrait(X,-B,-variance_formula)-1"></a><a class="docs-heading-anchor-permalink" href="#method-1:-VCMTrait(X,-B,-variance_formula)" title="Permalink"></a></h2><pre><code class="language-none">**X: Matrix of both genetic and non-genetic predictors**
**B: Matrix of both genetic and non-genetic regression coefficients**
**variance_formula: formula to specify the models variance components**</code></pre><p>Users who only have a few number of genetic predictors may find this model specification most user friendly. The genetic predictors are concatenated with the non-genetic predictors to form the overall design matrix. Similarly, the regression coefficients of both genetic and non-genetic predictors are concatenated to make the full matrix of regression coefficients.</p><pre><code class="language-julia">X_full = hcat(X, locus)  # full design matrix with both non-genetic and genetic predictors
B_full = vcat(B, γ)      # full matrix of regression coefficients for both non-genetic and genetic predictors 
genetic_model1 = VCMTrait(X_full, B_full, variance_formula)</code></pre><pre><code class="language-none">Variance Component Model
  * number of traits: 2
  * number of variance components: 2
  * sample size: 10</code></pre><pre><code class="language-julia">Random.seed!(1234)
y1 = simulate(genetic_model1)</code></pre><pre><code class="language-none">10×2 Array{Float64,2}:
  6.93768    -3.72705
 -7.26476    -0.0815147
 -0.915509    0.478916
 -5.31707     8.93169
 -0.385205   -3.06236
 13.4914      4.6258
  3.12911     0.639182
  0.178557    1.10218
  2.59476     0.0360991
 -5.39579   -11.2104</code></pre><h2 id="method-2:-VCMTrait(mean_-formulas,-DataFrame,-variance_-formula)"><a class="docs-heading-anchor" href="#method-2:-VCMTrait(mean_-formulas,-DataFrame,-variance_-formula)">method 2: VCMTrait(mean_ formulas, DataFrame, variance_ formula)</a><a id="method-2:-VCMTrait(mean_-formulas,-DataFrame,-variance_-formula)-1"></a><a class="docs-heading-anchor-permalink" href="#method-2:-VCMTrait(mean_-formulas,-DataFrame,-variance_-formula)" title="Permalink"></a></h2><pre><code class="language-none">**mean_formulas: Vector of strings, specifying mean effect for each trait**
**DataFrame: Named DataFrame of both genetic and non-genetic regression coefficients**
**variance_formula: formula to specify the models variance components**</code></pre><p>Users who feel more comfortable using the formulas to specify both the mean and variance of the simulation model may do so on a data frame with names corresponding to the predictors specified in the mean_formula. </p><pre><code class="language-julia">mean_formulas = [&quot;1.0*predictor1 + 0.950498*predictor2 + 0.372575*locus&quot;, &quot;1.0*predictor1 + 0.96467*predictor2 + 0.150508*locus&quot;]
data_frame_X_full = DataFrame(predictor1 = X_full[:, 1], predictor2 = X_full[:, 2], locus = X_full[:, 3])
genetic_model2 = VCMTrait(mean_formulas, data_frame_X_full, variance_formula)</code></pre><pre><code class="language-none">Variance Component Model
  * number of traits: 2
  * number of variance components: 2
  * sample size: 10</code></pre><pre><code class="language-julia">Random.seed!(1234)
y2 = simulate(genetic_model2)</code></pre><pre><code class="language-none">10×2 Array{Float64,2}:
  6.93768    -3.72705
 -7.26476    -0.0815147
 -0.915509    0.478916
 -5.31707     8.93169
 -0.385205   -3.06236
 13.4914      4.6258
  3.12911     0.639182
  0.178557    1.10218
  2.59476     0.0360991
 -5.39579   -11.2104</code></pre><h2 id="method-3:-VCMTrait(X,-B,-Σ,-V)"><a class="docs-heading-anchor" href="#method-3:-VCMTrait(X,-B,-Σ,-V)">method 3: VCMTrait(X, B, Σ, V)</a><a id="method-3:-VCMTrait(X,-B,-Σ,-V)-1"></a><a class="docs-heading-anchor-permalink" href="#method-3:-VCMTrait(X,-B,-Σ,-V)" title="Permalink"></a></h2><p>To specify many variance components, users can decide not to use formulas and specify just the necessary mean and variance components as follows.</p><pre><code class="language-none">**X_full: Matrix of both genetic and non-genetic predictors**
**B_full: Matrix of both genetic and non-genetic regression coefficients**
**Σ: Collection of all m Variance Components **
**V: Collection of all m Variance Covariance Matrices**</code></pre><p>For users who have potentially many non-genetic predictors and many variance components, the formula specification can be avoided alltogether.</p><pre><code class="language-julia">Σ = [Σ...] # Σ = [Σ[1], Σ[2]] collect all the variance components 
V = [V...] # V = [V[1], V[2]] collect all the variance covariance matrices
genetic_model3 = VCMTrait(X_full, B_full, Σ, V)</code></pre><pre><code class="language-none">Variance Component Model
  * number of traits: 2
  * number of variance components: 2
  * sample size: 10</code></pre><pre><code class="language-julia">Random.seed!(1234)
y3 = simulate(genetic_model3)</code></pre><pre><code class="language-none">10×2 Array{Float64,2}:
  6.93768    -3.72705
 -7.26476    -0.0815147
 -0.915509    0.478916
 -5.31707     8.93169
 -0.385205   -3.06236
 13.4914      4.6258
  3.12911     0.639182
  0.178557    1.10218
  2.59476     0.0360991
 -5.39579   -11.2104</code></pre><h2 id="method-4:-VCMTrait(X,-B,-G,-γ,-variance_formula)"><a class="docs-heading-anchor" href="#method-4:-VCMTrait(X,-B,-G,-γ,-variance_formula)">method 4: VCMTrait(X, B, G, γ, variance_formula)</a><a id="method-4:-VCMTrait(X,-B,-G,-γ,-variance_formula)-1"></a><a class="docs-heading-anchor-permalink" href="#method-4:-VCMTrait(X,-B,-G,-γ,-variance_formula)" title="Permalink"></a></h2><pre><code class="language-none">**X: Matrix of non-genetic predictors**
**B: Matrix of regression coefficients for non-genetic predictors**
**G: Matrix of genetic predictors (specified as a SnpArray)**
**γ: Matrix of regression coefficients for genetic predictors (snps)**
**variance_formula: formula to specify the models variance components**</code></pre><p>For users who have potentially many non-genetic predictors and a vast number of SNPs, the SNPs may be specified separately as a SnpArray for maximum efficiency. For users who are interested in this case, please take a look at the SnpArrays documentation for more details on <a href="https://openmendel.github.io/SnpArrays.jl/latest/#Linear-algebra-1">LinearAlgebra using SnpArrays</a></p><pre><code class="language-julia">genetic_model4 =  VCMTrait(X, B, G, γ, variance_formula)</code></pre><pre><code class="language-none">Variance Component Model
  * number of traits: 2
  * number of variance components: 2
  * sample size: 10</code></pre><pre><code class="language-julia">Random.seed!(1234)
y4 = simulate(genetic_model4)</code></pre><pre><code class="language-none">10×2 Array{Float64,2}:
  6.93768    -3.72705
 -7.26476    -0.0815147
 -0.915509    0.478916
 -5.31707     8.93169
 -0.385205   -3.06236
 13.4914      4.6258
  3.12911     0.639182
  0.178557    1.10218
  2.59476     0.0360991
 -5.39579   -11.2104</code></pre><h2 id="method-5:-VCMTrait(X,-B,-G,-γ,-Σ,-V)"><a class="docs-heading-anchor" href="#method-5:-VCMTrait(X,-B,-G,-γ,-Σ,-V)">method 5: VCMTrait(X, B, G, γ,  Σ, V)</a><a id="method-5:-VCMTrait(X,-B,-G,-γ,-Σ,-V)-1"></a><a class="docs-heading-anchor-permalink" href="#method-5:-VCMTrait(X,-B,-G,-γ,-Σ,-V)" title="Permalink"></a></h2><pre><code class="language-none">**X: Matrix of non-genetic predictors**
**B: Matrix of regression coefficients for non-genetic predictors**
**G: Matrix of genetic predictors (specified as a SnpArray)**
**γ: Matrix of regression coefficients for genetic predictors (snps)**
**Σ: Collection of all m Variance Components **
**V: Collection of all m Variance Covariance Matrices**</code></pre><p>For users who have potentially many non-genetic predictors, a vast number of SNPs, and many variance components, the SNPs may be specified separately as a SnpArray for maximum efficiency and the variance components may be specified as a list. For users who are interested in this case, please take a look at the SnpArrays documentation for more details on <a href="https://openmendel.github.io/SnpArrays.jl/latest/#Linear-algebra-1">LinearAlgebra using SnpArrays</a></p><pre><code class="language-julia">genetic_model5 =  VCMTrait(X, B, G, γ, [Σ...], [V...])</code></pre><pre><code class="language-none">Variance Component Model
  * number of traits: 2
  * number of variance components: 2
  * sample size: 10</code></pre><pre><code class="language-julia">Random.seed!(1234)
y5 = simulate(genetic_model5)</code></pre><pre><code class="language-none">10×2 Array{Float64,2}:
  6.93768    -3.72705
 -7.26476    -0.0815147
 -0.915509    0.478916
 -5.31707     8.93169
 -0.385205   -3.06236
 13.4914      4.6258
  3.12911     0.639182
  0.178557    1.10218
  2.59476     0.0360991
 -5.39579   -11.2104</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ukbiobank_ordered_multinomial_power/">« Trait Simulation - Ordinal Multinomial Power</a><a class="docs-footer-nextpage" href="../simulate_testing_threads.jl/">Exploring Multithreading Potential »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 10 July 2020 04:39">Friday 10 July 2020</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
